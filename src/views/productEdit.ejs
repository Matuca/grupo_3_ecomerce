<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/css/productEdit.css" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js""></script>
  <title>Editar publicaci칩n</title>
</head>

<body>
  <div class="productForm">
    <div class="logo">
      <a href="/">
        <img src="/img/amazona-negro.png" alt="Amazona" />
      </a>
    </div>
    <h2>Editar Producto</h2>

    <form enctype="multipart/form-data" action="/product/edit/<%= producto.idpublicacion %>?_method=PUT" method="POST">

      <div class="tituloForm">
        <label for="titulo">Titulo del producto:</label>
        <input type="text" name="titulo" id="titulo" value="<%= producto.titulo %> " />
      </div>
      <div class="descripcionForm">
        <label for="descripcion">Descripcion del producto:</label>
        <textarea name="descripcion" id="descripcion"><%= producto.descripcion %></textarea>
      </div>

      <div class="precioForm">
        <label for="precio">Precio:</label>
        <input type="number" name="precio" id="precio" step="0.01" value="<%= parseInt(producto.precio) %>" />
      </div>
      <div class="colorForm">
        <label for="color">Color/es:</label>
        <input type="text" name="color" value="<%= producto.color %>">
      </div>
      <div class="marcaForm">
        <label for="marca">Marca:</label>
        <input type="text" name="marca" value="<%= producto.marca %> ">
      </div>
      <div class="img-princialactual">
          
        <% for(var i = 0; i < producto.imagenes.length; i++){ %>
          
          <% if(producto.imagenes[i].imagenprincipal == 1){ %>
            <div class="contenedorimgen">
              <img src="/img/<%= producto.imagenes[i].imagen %>" alt="<%= producto.imagenes[i].nombre %>" class="img-imagen" />
              <span style="position:relative"><a href="#" onclick=deleteImage(<%= producto.idpublicacion %>,<%= producto.imagenes[i].idimagen %>)>Eliminar Imagen</a></span>
              </div>
          <% } %>
        <% } %>
      

      </div>
      <div class="imagenPrincipal">
       
        <h5>Agregar im치gen principal</h5>
        <br>
        <div class="imagenForm">
          <label for="imagenPrincipal">Seleccionar Imagen</label>
          <input type="file" name="imagenPrincipal" id="imagenPrincipal" accept="image/*" />
          <% if(locals && locals.mensaje){ %>

          <br>
          <div class="error">

            <%= mensaje.descripcion %>

          </div>
          <%  
            }
             %>
        </div>
      </div>
      <div class="img-princialactual">
          
        <% for(var i = 0; i < producto.imagenes.length; i++){ %>
          
          <% if(producto.imagenes[i].imagenprincipal == 0){ %>
            <div class="contenedorimgen">
          <img src="/img/<%= producto.imagenes[i].imagen %>" alt="<%= producto.imagenes[i].nombre %>" class="img-imagen" />
          <span style="position:relative"><a href="#" onclick=deleteImage(<%= producto.idpublicacion %>,<%= producto.imagenes[i].idimagen %>)>Eliminar Imagen</a></span>
          </div>
          <% } %>
        <% } %>
      

      </div>
      <div class="imagenesSecundarias">
        <h5>Agregar im치genes secundarias</h5>
        <div class="imagenForm">
          <label for="imagenSecundaria">Seleccionar im치genes</label>
          <input type="file" name="imagenSecundaria[]" id="imagenSecundaria" accept="image/*" multiple />
        </div>
      </div>
      <div class="submitForm">
        <button type="submit">Guardar</button>
      </div>
    </form>
  </div>
  <script>
    function deleteImage(publicacion,imagen) {
    $.ajax({
        url: '/product/delete/publicacion/'+publicacion+'/image/'+imagen,
        type: 'DELETE',
        success: function (result) {
            
            if(result.resultado=='ok'){
                alert(result.mensaje);
                location.reload();
            }else {
                console.error(result.mensaje);
                alert(result.mensaje);
            }
            
            
        }
    });
}
</script>
</body>

</html>